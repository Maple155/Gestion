<!-- templates/stock/dashboard/index.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${title}">Dashboard Stock</title>

    <!-- Bootstrap 5 -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
    />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Vos styles existants */
        .kpi-card {
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .kpi-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .alert-badge {
            position: absolute;
            top: -10px;
            right: -10px;
        }
        .valorisation-methode {
            border-left: 4px solid;
            padding-left: 15px;
        }
        .valorisation-fifo {
            border-color: #28a745;
        }
        .valorisation-fefo {
            border-color: #ffc107;
        }
        .valorisation-cump {
            border-color: #17a2b8;
        }
        .movement-entree {
            color: #28a745;
        }
        .movement-sortie {
            color: #dc3545;
        }
        .badge-lot {
            font-size: 0.7rem;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div class="flex h-screen">
        <div th:replace="~{fragments/sidebar_stock}"></div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <div class="container-fluid mt-4">
                <!-- En-tête -->
                <div class="row mb-4">
                    <div class="col">
                        <h1><i class="bi bi-speedometer2"></i> Dashboard Stock</h1>
                        <p class="text-muted">
                            <i class="bi bi-calendar"></i>
                            <span th:text="${#temporals.format(dateJour, 'dd MMMM yyyy')}"></span>
                        </p>
                    </div>
                </div>

                <!-- Section 1: KPI Principaux -->
                <div class="row mb-4">
                    <!-- Valeur Stock Total -->
                    <div class="col-md-3">
                        <div class="kpi-card bg-white">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="kpi-value text-primary"
                                         th:text="${kpis != null and kpis.valeurStockTotal != null ? #numbers.formatCurrency(kpis.valeurStockTotal) : '0 €'}">
                                        2.500.000 €
                                    </div>
                                    <div class="kpi-label">Valeur Stock Total</div>
                                </div>
                                <i class="bi bi-box-seam text-primary" style="font-size: 2rem"></i>
                            </div>
                            <small class="text-success" th:if="${kpis != null and kpis.evolutionValeur != null and kpis.evolutionValeur > 0}">
                                <i class="bi bi-arrow-up"></i>
                                <span th:text="${kpis.evolutionValeur}">+3.2%</span> vs mois dernier
                            </small>
                        </div>
                    </div>

                    <!-- Rotation Stock -->
                    <div class="col-md-3">
                        <div class="kpi-card bg-white">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="kpi-value text-info"
                                         th:text="${kpis != null and kpis.rotationMoyenne != null ? kpis.rotationMoyenne : '0.0'}">
                                        4.2x
                                    </div>
                                    <div class="kpi-label">Rotation (12 mois)</div>
                                </div>
                                <i class="bi bi-arrow-repeat text-info" style="font-size: 2rem"></i>
                            </div>
                            <small class="text-muted">
                                <i class="bi bi-info-circle"></i> Cible: 6x
                            </small>
                        </div>
                    </div>

                    <!-- Articles Actifs -->
                    <div class="col-md-3">
                        <div class="kpi-card bg-white">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="kpi-value text-warning"
                                         th:text="${kpis != null and kpis.nombreArticlesActifs != null ? kpis.nombreArticlesActifs : '0'}">
                                        1.234
                                    </div>
                                    <div class="kpi-label">Articles Actifs</div>
                                </div>
                                <i class="bi bi-tags text-warning" style="font-size: 2rem"></i>
                            </div>
                            <small>
                                <span th:text="${kpis != null and kpis.articlesRupture != null ? kpis.articlesRupture : '0'}"
                                      class="text-danger"></span>
                                en alerte stock
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Valorisation FIFO/FEFO -->
                <div class="row mb-4" th:if="${valorisation != null}">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-calculator"></i> Valorisation du Stock
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- FIFO -->
                                    <div class="col-md-4">
                                        <div class="valorisation-methode valorisation-fifo">
                                            <h6><i class="bi bi-sort-numeric-down"></i> FIFO</h6>
                                            <h4 class="text-success"
                                                th:text="${valorisation.valeurFifo != null ? #numbers.formatCurrency(valorisation.valeurFifo) : '0 €'}">
                                                1.250.000 €
                                            </h4>
                                            <div class="progress mb-2" style="height: 10px">
                                                <div class="progress-bar bg-success"
                                                     role="progressbar"
                                                     th:style="'width: ' + ${valorisation.pourcentageFifo != null ? valorisation.pourcentageFifo : 0} + '%;'"
                                                     th:attr="aria-valuenow=${valorisation.pourcentageFifo != null ? valorisation.pourcentageFifo : 0}"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            </div>
                                            <small class="text-muted">
                                                <span th:text="${valorisation.pourcentageFifo != null ? valorisation.pourcentageFifo : 0}">50</span>% du total
                                                <br />
                                                <span th:text="${valorisation.articlesFifo != null ? valorisation.articlesFifo : 0}">45</span> articles
                                            </small>
                                        </div>
                                    </div>

                                    <!-- FEFO -->
                                    <div class="col-md-4">
                                        <div class="valorisation-methode valorisation-fefo">
                                            <h6><i class="bi bi-calendar-x"></i> FEFO</h6>
                                            <h4 class="text-warning"
                                                th:text="${valorisation.valeurFefo != null ? #numbers.formatCurrency(valorisation.valeurFefo) : '0 €'}">
                                                50.000 €
                                            </h4>
                                            <div class="progress mb-2" style="height: 10px">
                                                <div class="progress-bar bg-warning"
                                                     role="progressbar"
                                                     th:style="'width: ' + ${valorisation.pourcentageFefo != null ? valorisation.pourcentageFefo : 0} + '%;'"
                                                     th:attr="aria-valuenow=${valorisation.pourcentageFefo != null ? valorisation.pourcentageFefo : 0}"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            </div>
                                            <small class="text-muted">
                                                <span th:text="${valorisation.pourcentageFefo != null ? valorisation.pourcentageFefo : 0}">2</span>% du total
                                                <br />
                                                <span th:text="${valorisation.articlesFefo != null ? valorisation.articlesFefo : 0}">12</span> articles périssables
                                            </small>
                                        </div>
                                    </div>

                                    <!-- CUMP -->
                                    <div class="col-md-4">
                                        <div class="valorisation-methode valorisation-cump">
                                            <h6><i class="bi bi-graph-up"></i> CUMP</h6>
                                            <h4 class="text-info"
                                                th:text="${valorisation.valeurCump != null ? #numbers.formatCurrency(valorisation.valeurCump) : '0 €'}">
                                                1.200.000 €
                                            </h4>
                                            <div class="progress mb-2" style="height: 10px">
                                                <div class="progress-bar bg-info"
                                                     role="progressbar"
                                                     th:style="'width: ' + ${valorisation.pourcentageCump != null ? valorisation.pourcentageCump : 0} + '%;'"
                                                     th:attr="aria-valuenow=${valorisation.pourcentageCump != null ? valorisation.pourcentageCump : 0}"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            </div>
                                            <small class="text-muted">
                                                <span th:text="${valorisation.pourcentageCump != null ? valorisation.pourcentageCump : 0}">48</span>% du total
                                                <br />
                                                <span th:text="${valorisation.articlesCump != null ? valorisation.articlesCump : 0}">1.177</span> articles
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Message si valorisation est null -->
                <div class="row mb-4" th:if="${valorisation == null}">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> Les données de valorisation ne sont pas disponibles.
                        </div>
                    </div>
                </div>

                <!-- Section 3: Alertes & Derniers Mouvements -->
                <div class="row mb-4">
                    <!-- Alertes -->
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-exclamation-triangle text-warning"></i>
                                    Alertes
                                    <span class="badge bg-warning"
                                          th:text="${alertes != null and alertes.nombreAlertes != null ? alertes.nombreAlertes : 0}">25</span>
                                </h5>
                            </div>
                            <div class="card-body" style="max-height: 300px; overflow-y: auto">
                                <div class="alert alert-warning"
                                     th:if="${alertes != null and alertes.lotsProchePeremption != null and alertes.lotsProchePeremption > 0}">
                                    <i class="bi bi-calendar-x"></i>
                                    <strong th:text="${alertes.lotsProchePeremption}">8</strong> lots proches péremption
                                    <br />
                                    <small>
                                        Valeur à risque:
                                        <span th:text="${alertes.valeurRisqueFefo != null ? #numbers.formatCurrency(alertes.valeurRisqueFefo) : '0 €'}">
                                            12.500 €
                                        </span>
                                    </small>
                                    <a href="/stock/lots/alertes" class="stretched-link"></a>
                                </div>

                                <!-- Ruptures -->
                                <div class="alert alert-danger"
                                     th:if="${alertes != null and alertes.rupturesStock != null and alertes.rupturesStock > 0}">
                                    <i class="bi bi-x-circle"></i>
                                    <strong th:text="${alertes.rupturesStock}">12</strong> articles en rupture
                                    <br />
                                    <small>Commandes client affectées</small>
                                    <a href="/stock/alertes" class="stretched-link"></a>
                                </div>

                                <!-- Surstocks -->
                                <div class="alert alert-info"
                                     th:if="${alertes != null and alertes.surstocks != null and alertes.surstocks > 0}">
                                    <i class="bi bi-arrow-up-circle"></i>
                                    <strong th:text="${alertes.surstocks}">5</strong> articles en surstock
                                    <br />
                                    <small>
                                        Immobilisation:
                                        <span th:text="${alertes.valeurSurstock != null ? #numbers.formatCurrency(alertes.valeurSurstock) : '0 €'}">
                                            85.000 €
                                        </span>
                                    </small>
                                    <a href="/stock/reporting/surstocks" class="stretched-link"></a>
                                </div>

                                <!-- Inventaires en attente -->
                                <div class="alert alert-secondary"
                                     th:if="${inventairesEnCours != null and !inventairesEnCours.empty}">
                                    <i class="bi bi-clipboard-check"></i>
                                    <strong th:text="${inventairesEnCours.size()}">3</strong> inventaires en attente
                                    <br />
                                    <small>Validation des écarts</small>
                                    <a href="/stock/inventaires" class="stretched-link"></a>
                                </div>

                                <!-- Message si aucune alerte -->
                                <div th:if="${alertes == null or 
                                    (alertes.lotsProchePeremption == null or alertes.lotsProchePeremption == 0) and
                                    (alertes.rupturesStock == null or alertes.rupturesStock == 0) and
                                    (alertes.surstocks == null or alertes.surstocks == 0) and
                                    (inventairesEnCours == null or inventairesEnCours.empty)}">
                                    <p class="text-muted text-center mb-0">
                                        <i class="bi bi-check-circle text-success"></i> Aucune alerte active
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Derniers Mouvements -->
                    <div class="col-lg-8">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-arrow-left-right"></i> Derniers Mouvements
                                </h5>
                            </div>
                            <div class="card-body" style="max-height: 300px; overflow-y: auto">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Article</th>
                                            <th>Quantité</th>
                                            <th>Dépôt</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="mvt : ${derniersMouvements != null ? derniersMouvements : {}}">
                                            <td>
                                                <span th:if="${mvt.type != null and mvt.type.sens != null and mvt.type.sens.name() == 'ENTREE'}"
                                                      class="badge bg-success">Entrée</span>
                                                <span th:if="${mvt.type != null and mvt.type.sens != null and mvt.type.sens.name() == 'SORTIE'}"
                                                      class="badge bg-danger">Sortie</span>
                                                <span th:if="${mvt.type == null or mvt.type.sens == null}"
                                                      class="badge bg-secondary">Inconnu</span>
                                            </td>
                                            <td>
                                                <a th:if="${mvt.article != null}"
                                                   th:href="@{'/stock/articles/' + ${mvt.article.codeArticle}}"
                                                   th:text="${mvt.article.codeArticle}">
                                                    ART-001
                                                </a>
                                                <span th:if="${mvt.article == null}">-</span>
                                            </td>
                                            <td th:text="${mvt.quantite != null ? mvt.quantite : '0'}">100</td>
                                            <td th:text="${mvt.depot != null ? mvt.depot.nom : '-'}">DEP-CENTRAL</td>
                                            <td>
                                                <small th:if="${mvt.dateMouvement != null}"
                                                       th:text="${#temporals.format(mvt.dateMouvement, 'dd/MM HH:mm')}">
                                                    15/03 14:30
                                                </small>
                                                <small th:if="${mvt.dateMouvement == null}">-</small>
                                            </td>
                                        </tr>
                                        <tr th:if="${derniersMouvements == null or derniersMouvements.empty}">
                                            <td colspan="5" class="text-center text-muted">
                                                Aucun mouvement récent
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Graphiques -->
                <div class="row mb-4">
                    <!-- Évolution valeur stock -->
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-graph-up"></i> Évolution Valeur Stock (12 mois)
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="evolutionChart" height="100"></canvas>
                                <p th:if="${evolution == null or evolution.empty}" class="text-muted text-center mt-3">
                                    Aucune donnée d'évolution disponible
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Top articles par valeur -->
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-trophy"></i> Top 5 Articles (Valeur)
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="list-group" th:if="${topArticles != null and !topArticles.empty}">
                                    <div th:each="article, iterStat : ${topArticles}"
                                         class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <span th:text="${iterStat.index + 1} + '. '"></span>
                                            <strong th:text="${article.code != null ? article.code : 'N/A'}">ART-001</strong>
                                            <br />
                                            <small class="text-muted" th:text="${article.libelle != null ? article.libelle : ''}">
                                                Laptop Pro
                                            </small>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-primary rounded-pill">
                                                <span th:text="${article.valeur != null ? #numbers.formatCurrency(article.valeur) : '0 €'}">
                                                    22.500 €
                                                </span>
                                            </span>
                                            <br />
                                            <small th:text="${article.quantite != null ? article.quantite + ' unités' : '0 unités'}">50 unités</small>
                                        </div>
                                    </div>
                                </div>
                                <p th:if="${topArticles == null or topArticles.empty}" class="text-muted text-center mb-0">
                                    Aucun article à afficher
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 5: Stocks par Dépôt -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-list-check"></i> Stocks par Dépôt
                                </h5>
                                <div>
                                    <select id="depotFilter" class="form-select form-select-sm w-auto d-inline-block me-2">
                                        <option value="">Tous les dépôts</option>
                                        <option th:each="depot : ${depots != null ? depots : {}}"
                                                th:value="${depot.id}"
                                                th:text="${depot.nom}">
                                            Dépôt Principal
                                        </option>
                                    </select>
                                    <button class="btn btn-sm btn-outline-primary" onclick="refreshStocksList()">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover table-sm" id="stocksTable">
                                        <thead>
                                            <tr>
                                                <th>Article</th>
                                                <th>Code</th>
                                                <th>Dépôt</th>
                                                <th>Quantité théorique</th>
                                                <th>Quantité réservée</th>
                                                <th>Quantité disponible</th>
                                                <th>Valeur (CUMP)</th>
                                                <th>Dernier mouvement</th>
                                                <th>Statut</th>
                                            </tr>
                                        </thead>
                                        <tbody id="stocksList">
                                            <!-- Les données seront chargées dynamiquement via AJAX -->
                                        </tbody>
                                    </table>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <div class="text-muted">
                                        <span id="stocksCount">0</span> articles en stock
                                    </div>
                                    <nav>
                                        <ul class="pagination pagination-sm mb-0" id="stocksPagination">
                                            <!-- Pagination dynamique -->
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        // Préparer les données pour le graphique
        const evolutionLabels = [
            /*[# th:each="item : ${evolution != null ? evolution : {}}"]*/
            "[[${item.mois}]]",
            /*[/]*/
        ];
        
        const evolutionValues = [
            /*[# th:each="item : ${evolution != null ? evolution : {}}"]*/
            [[${item.valeur}]],
            /*[/]*/
        ];

        // Données par défaut si vides
        if (evolutionLabels.length === 0) {
            evolutionLabels.push("Jan", "Fév", "Mar", "Avr", "Mai", "Juin");
            evolutionValues.push(0, 0, 0, 0, 0, 0);
        }

        const evolutionData = {
            labels: evolutionLabels,
            datasets: [{
                label: "Valeur Stock",
                data: evolutionValues,
                borderColor: "#28a745",
                backgroundColor: "rgba(40, 167, 69, 0.1)",
                fill: true,
                tension: 0.4,
            }],
        };

        // Initialiser le graphique
        window.onload = function () {
            const ctx = document.getElementById("evolutionChart").getContext("2d");
            new Chart(ctx, {
                type: "line",
                data: evolutionData,
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function (value) {
                                    return new Intl.NumberFormat("fr-FR", {
                                        style: "currency",
                                        currency: "EUR",
                                        minimumFractionDigits: 0,
                                    }).format(value);
                                },
                            },
                        },
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return new Intl.NumberFormat("fr-FR", {
                                        style: "currency",
                                        currency: "EUR",
                                    }).format(context.raw);
                                },
                            },
                        },
                    },
                },
            });
            
            // Charger la liste des stocks
            loadStocksList();
            
            // Actualiser toutes les 2 minutes
            setInterval(loadStocksList, 120000);
        };

        // Fonction pour charger la liste des stocks
        function loadStocksList(page = 0, size = 10, depotId = '') {
            const url = new URL('/main/dashboard/api/stocks/liste', window.location.origin);
            url.searchParams.append('page', page);
            url.searchParams.append('size', size);
            if (depotId) {
                url.searchParams.append('depotId', depotId);
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateStocksTable(data.stocks || []);
                        updateStocksPagination(data);
                        document.getElementById('stocksCount').textContent = data.totalItems || 0;
                    } else {
                        console.error('Erreur:', data.message);
                        showStocksError(data.message);
                    }
                })
                .catch(error => {
                    console.error('Erreur chargement stocks:', error);
                    showStocksError('Erreur de chargement');
                });
        }

        // Fonction pour afficher une erreur dans le tableau
        function showStocksError(message) {
            const tbody = document.getElementById('stocksList');
            tbody.innerHTML = `
                <tr>
                    <td colspan="9" class="text-center text-danger">
                        <i class="bi bi-exclamation-triangle"></i> Erreur: ${message}
                    </td>
                </tr>
            `;
        }

        // Fonction pour mettre à jour le tableau des stocks
        function updateStocksTable(stocks) {
            const tbody = document.getElementById('stocksList');
            tbody.innerHTML = '';
            
            if (!stocks || stocks.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted">
                            Aucun stock trouvé
                        </td>
                    </tr>
                `;
                return;
            }
            
            stocks.forEach(stock => {
                const row = document.createElement('tr');
                
                // Définir la classe en fonction du statut
                let rowClass = '';
                let statutBadge = '';
                
                switch(stock.statut) {
                    case 'RUPTURE':
                        rowClass = 'table-danger';
                        statutBadge = '<span class="badge bg-danger">Rupture</span>';
                        break;
                    case 'ALERTE':
                        rowClass = 'table-warning';
                        statutBadge = '<span class="badge bg-warning">Alerte</span>';
                        break;
                    case 'SURSTOCK':
                        rowClass = 'table-info';
                        statutBadge = '<span class="badge bg-info">Surstock</span>';
                        break;
                    default:
                        statutBadge = '<span class="badge bg-success">Normal</span>';
                }
                
                row.className = rowClass;
                
                // Formater la date
                const dateMouvement = stock.dateDernierMouvement 
                    ? new Date(stock.dateDernierMouvement).toLocaleDateString('fr-FR')
                    : 'N/A';
                
                // Formater la valeur monétaire
                const valeurFormattee = new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR'
                }).format(stock.valeurStockCump || 0);
                
                row.innerHTML = `
                    <td>${stock.articleLibelle || '-'}</td>
                    <td>
                        <a href="/main/dashboard/article/${stock.articleCode || ''}" 
                           class="text-decoration-none">
                            ${stock.articleCode || '-'}
                        </a>
                    </td>
                    <td>${stock.depotNom || '-'} (${stock.depotCode || '-'})</td>
                    <td>${stock.quantiteTheorique || 0}</td>
                    <td>${stock.quantiteReservee || 0}</td>
                    <td class="fw-bold">${stock.quantiteDisponible || 0}</td>
                    <td>${valeurFormattee}</td>
                    <td>${dateMouvement}</td>
                    <td>${statutBadge}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Fonction pour mettre à jour la pagination
        function updateStocksPagination(data) {
            const pagination = document.getElementById('stocksPagination');
            pagination.innerHTML = '';
            
            const currentPage = data.currentPage || 0;
            const totalPages = data.totalPages || 1;
            
            // Bouton précédent
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 0 ? 'disabled' : ''}`;
            prevLi.innerHTML = `
                <a class="page-link" href="#" onclick="loadStocksList(${currentPage - 1})" aria-label="Précédent">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            `;
            pagination.appendChild(prevLi);
            
            // Pages numérotées
            const startPage = Math.max(0, currentPage - 2);
            const endPage = Math.min(totalPages - 1, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `
                    <a class="page-link" href="#" onclick="loadStocksList(${i})">
                        ${i + 1}
                    </a>
                `;
                pagination.appendChild(pageLi);
            }
            
            // Bouton suivant
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage >= totalPages - 1 ? 'disabled' : ''}`;
            nextLi.innerHTML = `
                <a class="page-link" href="#" onclick="loadStocksList(${currentPage + 1})" aria-label="Suivant">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            `;
            pagination.appendChild(nextLi);
        }

        // Fonction pour filtrer par dépôt
        document.getElementById('depotFilter').addEventListener('change', function() {
            const depotId = this.value;
            loadStocksList(0, 10, depotId);
        });

        // Fonction pour rafraîchir la liste
        function refreshStocksList() {
            const depotSelect = document.getElementById('depotFilter');
            loadStocksList(0, 10, depotSelect.value);
        }
        /*]]>*/
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>